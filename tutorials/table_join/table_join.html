<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}table td,table th{padding:0}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c6{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c4{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c5{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c3{color:inherit;text-decoration:inherit}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c5 doc-content"><p class="c2"><span class="c1">In this tutorial, you will see a simple Table Join operation using postgreSQL. This is required when you need to add some information to the shapefile attribute from other tabular data. For this workflow, we will prepare the data to create a population density map for the year 2022 for California. We will use a shapefile of census tracts for California and a population data table from the US Bureau. </span></p><p class="c2"><span>You can get more information on downloading the dataset from the tutorial which &nbsp;demonstrates the same using QGIS tools. - </span><span class="c4"><a class="c3" href="https://www.google.com/url?q=https://www.qgistutorials.com/en/docs/3/performing_table_joins.html&amp;sa=D&amp;source=editors&amp;ust=1730044591274607&amp;usg=AOvVaw23_UrqQyLFBJPaaNwPveGy">https://www.qgistutorials.com/en/docs/3/performing_table_joins.html</a></span><span class="c1">. </span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">You can download a copy of both the datasets below.</span></p><p class="c2"><span class="c1">1</span></p><p class="c2"><span class="c1">2</span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c6">Workflow</span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">1. We will upload the input data files to the server using QGIS. First, connect to the server using the PostgreSQL option in the browser panel. Right-click on PostgreSQL &ndash;&gt; New Connection. You can skip this if already connected to the server. </span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 1966.00px; height: 1507.57px;"><img alt="" src="images/image14.png" style="width: 1966.00px; height: 1520.00px; margin-left: 0.00px; margin-top: -0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">2. You will see the dialogue where you need to fill in the details and credentials to connect to the server. Fill all the required details and click &lsquo;Ok&rsquo; to connect. </span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 621.50px; height: 1072.98px;"><img alt="" src="images/image15.png" style="width: 621.50px; height: 1072.98px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c1">3. Next step is to upload the population table and the tracts shapefile to the database. We will add the population CSV to the QGIS to format it correctly and detect the field type. Click on the &lsquo;Data Source Manager&rsquo; icon and look for the &lsquo;Delimited Text&rsquo; option as we are adding the CSV file.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 781.19px; height: 565.39px;"><img alt="" src="images/image8.png" style="width: 781.19px; height: 565.39px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span>4. Browse to the file and set the layer name as &lsquo;california_population&rsquo; to simplify. Our CSV data has two headers columns where the first one looks irrelevant. Under the &lsquo;Record and Fields Options&rsquo; we will choose 1 column to discard from the top. Click on &lsquo;Add&rsquo; to see the &lsquo;california_population layer loaded in QGIS.&rsquo;</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 769.50px; height: 645.26px;"><img alt="" src="images/image9.png" style="width: 769.50px; height: 645.26px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">5. We have over 450 fields in the table. We just need the total estimated population and some fields with the location information. Let&rsquo;s delete fields that are not required. Go to Processing -&gt; Toolbox and search for &lsquo;Retain Fields&rsquo; tool.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 814.17px; height: 615.81px;"><img alt="" src="images/image17.png" style="width: 850.39px; height: 615.81px; margin-left: -18.11px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">6. Select the &lsquo;california_population&rsquo; table as Input Layer and click on the &hellip; button for field selection.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 822.22px; height: 660.38px;"><img alt="" src="images/image6.png" style="width: 822.22px; height: 660.38px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span>7. Select the top three fields which are &lsquo;Geography&rsquo;, &lsquo;Geographic Area Name&rsquo; and &lsquo;Estimate!!Total!!Total Population&rsquo; and click &lsquo;Ok&rsquo;.</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 832.62px; height: 661.96px;"><img alt="" src="images/image10.png" style="width: 832.62px; height: 661.96px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c1">8. Keep the Output Layer field empty and click the &lsquo;Run&rsquo; button to generate the temporary output with required fields.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 851.36px; height: 679.72px;"><img alt="" src="images/image1.png" style="width: 851.36px; height: 679.72px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">9. Now, we will add this table to the postgres database. Go to Database - &gt; DB Manager.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 731.50px; height: 585.64px;"><img alt="" src="images/image7.png" style="width: 731.50px; height: 585.64px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c1">&nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c2"><span class="c1">10. In the DB Manager window, you will see a postGIS provider and the postgres server connection. It has the default &lsquo;public&rsquo; schema. We will upload our tables to the schema. Select the schema and click on &lsquo;Import Layer/File&rsquo; to upload the &lsquo;Retained Fields&rsquo; table. </span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 808.46px; height: 608.97px;"><img alt="" src="images/image5.png" style="width: 808.46px; height: 608.97px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c1">11. You will see the window to upload the layer where you will select the input layer, give the table name, create an &lsquo;id&rsquo; field as primary key. Check the box to convert field names to lower case and click &lsquo;Ok&rsquo;.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 814.60px; height: 1090.45px;"><img alt="" src="images/image12.png" style="width: 814.60px; height: 1090.45px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c1">12. You will see the message when it will be uploaded successfully. </span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 506.00px; height: 268.00px;"><img alt="" src="images/image2.png" style="width: 506.00px; height: 268.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c1">13. Next step is to upload the California tracts shapefile on the postgres database. It has the spatial information and we need a postGIS extension to work with the spatial data on postgres. </span></p><p class="c2"><span class="c1">In the DB Manager switch to &lsquo;SQL Window&rsquo;.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 795.50px; height: 696.21px;"><img alt="" src="images/image3.png" style="width: 795.50px; height: 696.21px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">&nbsp;14. In the query window, use the following command to add the postGIS extension to your postgres server. Click on the &lsquo;Execute&rsquo; button to add the extension. </span></p><p class="c2"><span class="c1">&lsquo;CREATE EXTENSION postgis&rsquo;</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 818.50px; height: 557.50px;"><img alt="" src="images/image16.png" style="width: 818.50px; height: 557.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c1">15. Now we are ready to upload the &lsquo;tl_2022_06_tract.shp&rsquo; to the server. We will directly add it to the server using &lsquo;DB Manager&rsquo;. Click on &lsquo;Import layer/file&rsquo; and browse to the &lsquo;tl_2022_06_tract.shp&rsquo; layer and give the name &lsquo;california_2022_tract&rsquo;. Let&rsquo;s check options for adding a primary key and &nbsp;a geometry column. We will check the option to convert fields to lowercase and add spatial index to the features for faster processing. Click &lsquo;Ok&rsquo; to upload.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 792.37px; height: 1050.56px;"><img alt="" src="images/image13.png" style="width: 792.37px; height: 1050.56px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c1">16. You will see the &lsquo;Import was Successful&rsquo; message as soon as it gets imported to the database. We can see the tables under the &lsquo;public&rsquo; schema. Select the table from the schema and switch to the &lsquo;Table&rsquo; window to view the table. Similarly you can switch to the &lsquo;Preview&rsquo; window to get the view of the shapefile.</span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 875.53px; height: 480.94px;"><img alt="" src="images/image4.png" style="width: 875.53px; height: 480.94px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 876.50px; height: 558.00px;"><img alt="" src="images/image11.png" style="width: 876.50px; height: 558.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c1">17. We will run queries to join the total population column to the tracts shapefile using a common geoid. The &lsquo;geoid&rsquo; field in the &lsquo;california_2022_tracts&rsquo; has unique ids for the tracts and the &lsquo;geography&rsquo; field in the &lsquo;california_population&rsquo; table has the long id for tracts within the US from which we can get the last 11 characters to match with the values in &lsquo;geoid&rsquo; field of the tracts table. We will apply queries given below to create a field named &lsquo;geoid&rsquo; in the population table to have a common unique field.</span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">Add a new column &lsquo;geoid_pop&rsquo; to the table &lsquo;california_population&rsquo;.</span></p><p class="c2"><span class="c1">ALTER TABLE california_population</span></p><p class="c2"><span class="c1">ADD COLUMN geoid_pop VARCHAR(20);</span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">Update the &lsquo;geoid_pop&rsquo; column with the last 11 characters of the &lsquo;geography&rsquo; field starting from 10th position.</span></p><p class="c2"><span class="c1">UPDATE california_population</span></p><p class="c2"><span class="c1">SET geoid_pop = SUBSTRING(&quot;geography&quot; FROM CHAR_LENGTH(&quot;geography&quot;) - 10 FOR 11);</span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">18. You will see the new column &lsquo;geoid_pop&rsquo; is added in the &lsquo;california_population&rsquo; table.</span></p><p class="c0"><span class="c1"></span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">19. Now, we will create a new table named &lsquo;california_tract_with_pop &rsquo; by joining population information from california_population table to the tract table. Execute the query as you see below and refresh to see the new table added under the &lsquo;public&rsquo; schema.</span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">The query selects all the columns from the &lsquo;california_2022_tract&rsquo; table and selects &quot;geographic area name&quot; and &quot;estimate!!total!!total population&quot; columns from the &lsquo;california_population&rsquo; table. We have assigned t1 and t2 to the input tables for ease in selecting the columns.</span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span class="c1">CREATE TABLE california_tract_with_pop </span></p><p class="c2"><span class="c1">AS SELECT &nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t1.*, &nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2.&quot;geographic area name&quot;, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t2.&quot;estimate!!total!!total population&quot; &nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c1">FROM &nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;california_2022_tract t1 </span></p><p class="c2"><span class="c1">JOIN</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;california_population t2 </span></p><p class="c2"><span class="c1">ON &nbsp; &nbsp; &nbsp;</span></p><p class="c2"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t1.geoid = t2.geoid_pop</span></p><p class="c0"><span class="c1"></span></p><p class="c2"><span>20. You can view the table and right click to get the option to add it to the canvas. </span></p></body></html>